%% This is file `novelette-language.sty',
%% part of `novelette' document class.
%% Copyright 2023 Robert Allgeyer.
%%
%% This file may be distributed and/or modified under the
%% conditions of the LaTeX Project Public License, either version 1.3c
%% of this license or (at your option) any later version.
%% The latest version of this license is in
%%    http://www.latex-project.org/lppl.txt
%% and version 1.3c or later is part of all distributions of LaTeX
%% version 2005/12/01 or later.
%%
\ProvidesFile{novelette-language.sty}%
[2023/01/20 v0.2 LaTeX file (language settings)]
%%


%% LANGUAGE
%% ----------------------------------------------------------------------------
% Novelette is intended for popular fiction, written in a single language.
% So, you may set only one main language, which will be used throughout
% your book for hyphenation patterns. The language does not implement other
% LaTeX-related features such as style of dates and times. Only hyphenation!
%   You may still write words and phrases in another language. You may even
% set one main language, then write in an entirely different language.
% Novelette will not complain. It does not know or care what you write.
% But words in the other language will be hyphenated according to the patterns
% of the main language. This may or may not be typogaphically incorrect.
% You can always manually hyphenate or un-hyphenate foreign words.  
%   The default hyphenation uses the old TeX "english" patterns. This is
% part of every TeX system. It will be used if you do not set language,
% or use an invalid language code, or more than one language. In these cases,
% a warning is issued. The log summary will show "default" as language.
%   Setting "english" will be interpreted as "default". It probably is not
% what you want. Use "en-US" or "en-GB" instead.
%   If you request an unlisted language variant, such as "fr-CA" for
% French Canadian, then Novelette will substitute the main language "fr".
% No warning is issued, but the log file will have an alert. In general,
% when a variant is unlisted, it means that hyphenation is the same as its
% main language.
%   Novelette does not provide automatic spacing adjustments, which is
% used by French. Do it manually.
% Noveletee does not provide automatic time and date format. In a work of
% fiction, you will hardly ever need it. Type it yourself!
%   If you need `lipsum', it is not available. Novelette has built-in nonsense
% text, available in document body by \fillertext command.
%%


%% Thanks Skillmon and DocOctal, tex.stackexchange.com q.508268, CC-BY-SA-3.0:
\ExplSyntaxOn
\cs_generate_variant:Nn \str_foldcase:n {e}
\NewDocumentCommand\nvt@getlc{m}{\str_foldcase:e{#1}}
\ExplSyntaxOff
\def\selectlanguage{}
%%

%%
\newcommand\nvt@readlang[1]{
  \StrDel{#1}{ }[\temp@s]
  \StrDel{\temp@s}{-}[\temp@s]
  \StrDel{\temp@s}{:}[\temp@s]
  \IfSubStr{\temp@s}{,}{\@warnTML}{}
  \xdef\nvt@lang{\nvt@getlc{\temp@s}}
}
%%

%%
\def\nvt@setlang{}
\newcounter{nvt@langcount}
\newcommand\setlang[1]{\gdef\nvt@setlang{#1}}
%%

\def\nvt@english{:english:en:default:latex:}
\def\nvt@american{:american:usenglish:usenglishmax:enus:englishus:}
\def\nvt@british{:british:engb:enuk:ukenglish:englishuk:englishgb:}
\def\nvt@spanish{:spanish:espanol:es:eses:}
\def\nvt@mexican{:mexican:esmx:}

%% Other languages may be added in the future. Any any case, only Western
%% European languages will be added.


%%
\def\@process@nvtlang{ % AtEndPreamble.
  \setcounter{nvt@langcount}{0}
  \IfSubStr{\nvt@american}{:\nvt@setlang:}{
    \stepcounter{nvt@langcount}
    \gdef\nvt@lang{american}
    \HyphenRules{usenglishmax}
  }{}
  \IfSubStr{\nvt@british}{:\nvt@setlang:}{
    \stepcounter{nvt@langcount}
    \ifnumless{\value{nvt@langcount}}{2}{
      \gdef\nvt@lang{british}
      \HyphenRules{ukenglish}  
    }{}
  }{}
  \IfSubStr{\nvt@spanish}{:\nvt@setlang:}{
    \stepcounter{nvt@langcount}
    \ifnumless{\value{nvt@langcount}}{2}{
      \gdef\nvt@lang{spanish}
      \HyphenRules{spanish}  
    }{}
  }{}
  %%
  %% If other languages are added, they go here.
  %%
  \ifnumless{\value{nvt@langcount}}{1}{
    \gdef\nvt@lang{american}
    \HyphenRules{usenglishmax}
    \@infoDEFL % Default language.
  }{}
  \ifnumgreater{\value{nvt@langcount}}{1}{
    \@warnTML % Too many languages.
  }{}
}
\@onlypreamble\setlang
%%


%%
\endinput
%%
%% End of file `novelette-language.sty'.
