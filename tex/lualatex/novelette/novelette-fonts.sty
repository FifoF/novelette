%% This is file `novelette-fonts.sty',
%% part of `novelette' document class.
%% Copyright 2023 Robert Allgeyer.
%%
%% This file may be distributed and/or modified under the
%% conditions of the LaTeX Project Public License, either version 1.3c
%% of this license or (at your option) any later version.
%% The latest version of this license is in
%%    http://www.latex-project.org/lppl.txt
%% and version 1.3c or later is part of all distributions of LaTeX
%% version 2005/12/01 or later.
%%
\ProvidesFile{novelette-fonts.sty}%
[2023/01/20 v0.2 LaTeX file (font settings and defaults)]
%%


%% Developer tool, for testing fonts. If used, must precede any \setfont.
\newcommand\kernoff{\gdef\nvt@maybekern{}}
\def\nvt@maybekern{Kerning=On,}
%%


%% FONT SELECTION (before fontspec loads)
% These commands may be used in Preamble. They merely save the settings.
% Later, fonts are created by \nvt@process@ macros.
\DeclareDocumentCommand\setfont{mmO{}}{
  \def\nvt@temp@s{main head name desc note deco alt init}
  \IfSubStr{\nvt@temp@s}{#1}{}{\nvt@errBFASF{#1}} % Bad first argument for setfont.
  \def\nvt@temp@s{Color color Colour colour Opacity opacity}
  \IfSubStr{\nvt@temp@s}{#3}{\nvt@errNCOF}{} % No color or opacity in font.
  \ifthenelse{\equal{#1}{main}}{\gdef\nvt@main@font{#2}\gdef\nvt@main@feat{#3}}{}
  \ifthenelse{\equal{#1}{head}}{\gdef\nvt@head@font{#2}\gdef\nvt@head@feat{#3}}{}
  \ifthenelse{\equal{#1}{name}}{\gdef\nvt@name@font{#2}\gdef\nvt@name@feat{#3}}{}
  \ifthenelse{\equal{#1}{desc}}{\gdef\nvt@desc@font{#2}\gdef\nvt@desc@feat{#3}}{}
  \ifthenelse{\equal{#1}{note}}{\gdef\nvt@note@font{#2}\gdef\nvt@note@feat{#3}}{}
  \ifthenelse{\equal{#1}{deco}}{\gdef\nvt@deco@font{#2}\gdef\nvt@deco@feat{#3}}{}
  \ifthenelse{\equal{#1}{alt}}{\gdef\nvt@alt@font{#2}\gdef\nvt@alt@feat{#3}}{}
  \ifthenelse{\equal{#1}{init}}{\gdef\nvt@init@font{#2}\gdef\nvt@init@feat{#3}}{}
}
\@onlypreamble\setfont
%%


%%
\def\nvt@pickdefaultfont{
  \gdef\nvt@main@feat{}
  \IfFontExistsTF{Swainson}{
    \gdef\nvt@main@font{Swainson}
  }{
    \IfFontExistsTF{EB Garamond}{
      \gdef\nvt@main@font{EB Garamond}
    }{
      \IfFontExistsTF{Libertinus Serif}{
        \gdef\nvt@main@font{Libertinus Serif}
      }{
        \IfFontExistsTF{Latin Modern Roman}{ % Almost all TeX has it.
          \gdef\nvt@main@font{Latin Modern Roman}
        }{\nvt@errRNDMF} % Really no default main font.
      }
    }
  }
}
%%


%%
\def\nvt@process@mainfont{ % After fontspec loads.
  \defaultfontfeatures{} % Reset.
  \defaultfontfeatures[\rmfamily,\sffamily]{\nvt@maybekern Numbers=OldStyle,%
    Ligatures=TeX,}
  \ifdefined\nvt@main@font
    \IfFontExistsTF{\nvt@main@font}{}{
      \nvt@warnNMFF{\nvt@main@font} % No main font found.
      \nvt@pickdefaultfont
    }
  \else
    \nvt@pickdefaultfont
  \fi
  \setmainfont{\nvt@main@font}[\nvt@main@feat]
  \let\mainfont\rmfamily\relax % Backwards compatibility.
  \xdef\log@mainfont{\string\setfont{main}{\nvt@main@font}\nvt@main@feat}
}
%%


%%
\def\nvt@process@headfont{
  \ifdefined\nvt@head@font\else\xdef\nvt@head@font{\nvt@main@font}\fi
  \ifdefined\nvt@head@feat\else\gdef\nvt@head@feat{}\fi
  \IfFontExistsTF{\nvt@head@font}{
    \newfontfamily\nvt@headfont{\nvt@head@font}[\nvt@head@feat]
  }{
    \nvt@warnNFF{\nvt@head@font}
    \newfontfamily\nvt@headfont{\nvt@main@font}
  }
  \xdef\log@headfont{\string\setfont{head}{\nvt@head@font}\nvt@head@feat}
}
%%


%%
\def\nvt@process@otherfonts{
  % name font:
  \ifdefined\nvt@name@font\else\xdef\nvt@name@font{\nvt@main@font}\fi
  \ifdefined\nvt@name@feat\else\gdef\nvt@name@feat{Scale=1.8}\fi
  \IfFontExistsTF{\nvt@name@font}{}{
    \nvt@warnNFF{\nvt@name@font}
    \xdef\nvt@name@font{\nvt@main@font}
  }
  \newfontfamily\nvt@namefont{\nvt@name@font}[\nvt@name@feat]
  \ifthenelse{\equal{\nvt@name@feat}{}}{\def\nvt@temp@s{}}{\def\nvt@temp@s{[\nvt@name@feat]}}
  \xdef\log@namefont{\string\setfont{name}{\nvt@name@font}\nvt@temp@s}
  % desc font:
  \ifdefined\nvt@desc@font\else\xdef\nvt@desc@font{\nvt@main@font}\fi
  \ifdefined\nvt@desc@feat\else\gdef\nvt@desc@feat{Scale=1.33}\fi
  \IfFontExistsTF{\nvt@desc@font}{}{
    \nvt@warnNFF{\nvt@desc@font} % No font found.
    \xdef\desc@font{\nvt@main@font}
  }
  \newfontfamily\nvt@descfont{\nvt@desc@font}[\nvt@desc@feat]
  \ifthenelse{\equal{\nvt@desc@feat}{}}{\def\nvt@temp@s{}}{\def\nvt@temp@s{[\nvt@desc@feat]}}
  \xdef\log@descfont{\string\setfont{desc}{\nvt@desc@font}\nvt@temp@s}
  % note font:
  \ifdefined\nvt@note@font\else\xdef\nvt@note@font{\nvt@main@font}\fi
  \ifdefined\nvt@note@feat\else\gdef\nvt@note@feat{}\fi
  \IfFontExistsTF{\nvt@note@font}{}{
    \nvt@warnNFF{\nvt@note@font} % No font found.
    \xdef\nvt@note@font{\nvt@main@font}
  }
  \newfontfamily\nvt@notefont{\nvt@note@font}[\nvt@note@feat]
  \ifthenelse{\equal{\nvt@desc@feat}{}}{\def\nvt@temp@s{}}{\def\nvt@temp@s{[\nvt@desc@feat]}}
  \xdef\log@notefont{\string\setfont{note}{\nvt@note@font}\nvt@temp@s}
  % deco font:
  \ifdefined\nvt@deco@font\else\xdef\nvt@deco@font{\nvt@main@font}\fi
  \ifdefined\nvt@deco@feat\else\gdef\nvt@deco@feat{}\fi
  \IfFontExistsTF{\nvt@deco@font}{}{
    \nvt@warnNFF{\nvt@deco@font} % No font found.
    \xdef\deco@font{\nvt@main@font}
  }
  \newfontfamily\nvt@decofont{\nvt@deco@font}[\nvt@deco@feat]
  \ifthenelse{\equal{\nvt@deco@feat}{}}{\def\nvt@temp@s{}}{\def\nvt@temp@s{[\nvt@deco@feat]}}
  \xdef\log@decofont{\string\setfont{deco}{\nvt@deco@font}\nvt@temp@s}
  % alt font:
  \ifdefined\nvt@alt@font\else\xdef\nvt@alt@font{\nvt@main@font}\fi
  \ifdefined\nvt@alt@feat\else\gdef\nvt@alt@feat{}\fi
  \IfFontExistsTF{\nvt@alt@font}{}{
    \nvt@warnNFF{\nvt@alt@font} % No font found.
    \xdef\nvt@alt@font{\nvt@main@font}
  }
  \newfontfamily\nvt@altfont{\nvt@alt@font}[\nvt@alt@feat]
  \ifthenelse{\equal{\nvt@alt@feat}{}}{\def\nvt@temp@s{}}{\def\nvt@temp@s{[\nvt@alt@feat]}}
  \xdef\log@altfont{\string\setfont{alt}{\nvt@alt@font}\nvt@temp@s}
  % init font:
  \ifdefined\nvt@init@font\else\xdef\nvt@init@font{\nvt@main@font}\fi
  \ifdefined\nvt@init@feat\else\gdef\nvt@init@feat{}\fi
  \IfFontExistsTF{\nvt@init@font}{}{
    \nvt@warnNFF{\nvt@init@font} % No font found.
    \xdef\nvtinit@font{\nvt@main@font}
  }
  \newfontfamily\nvt@initfont{\nvt@init@font}[\nvt@init@feat]
  \ifthenelse{\equal{\nvt@init@feat}{}}{\def\nvt@temp@s{}}{\def\nvt@temp@s{[\nvt@init@feat]}}
  \xdef\log@initfont{\string\setfont{init}{\nvt@init@font}\nvt@temp@s}
}
%%


%%
\newcommand\fontclass[1]{%
  \IfInteger{#1}{%
    \gdef\nvt@fontclass{#1}%
  }{%
    \ClassWarning{novelette}{\string\fontclass\space accepts only integer.^^J%
      Using default fontclass 0.}%
    \gdef\nvt@fontclass{0}%
  }%
}
\fontclass{0} % Default
\@onlypreamble\fontclass
%%


%%
\endinput
%%
%% End of file `novelette-fonts.sty'


